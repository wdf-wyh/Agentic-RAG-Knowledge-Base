# Agentic RAG ç³»ç»Ÿæ¶æ„æ–‡æ¡£

> å‡çº§æ—¥æœŸï¼š2024å¹´12æœˆ31æ—¥
> ç‰ˆæœ¬ï¼š3.0.0

## ğŸ¯ é¡¹ç›®å®šä½

**"å…¨è‡ªåŠ¨çŸ¥è¯†èµ„äº§ç®¡ç† Agent"** â€”â€” åŸºäº RAG æ£€ç´¢é“¾è·¯ï¼Œå¼•å…¥ ReActï¼ˆæ¨ç†-è¡ŒåŠ¨ï¼‰æ¡†æ¶ï¼Œä½¿ Agent èƒ½å¤Ÿè‡ªä¸»ç®¡ç†ã€é‡æ„å’Œçº é”™çŸ¥è¯†åº“å†…å®¹ã€‚

## ğŸ§  æ ¸å¿ƒç†å¿µ

### RAG vs Agent çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agentic RAG ç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚   â”‚   Agent     â”‚  â† å¤§è„‘ï¼ˆå†³ç­–ã€è§„åˆ’ã€åæ€ï¼‰                 â”‚
â”‚   â”‚  (ReAct)    â”‚                                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    å·¥å…·å±‚ (Tools)                     â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚   RAG    â”‚   æ–‡ä»¶   â”‚  ç½‘é¡µ    â”‚   åˆ†æ   â”‚  é€šçŸ¥   â”‚  â”‚
â”‚   â”‚  æ£€ç´¢    â”‚   æ“ä½œ   â”‚  æœç´¢    â”‚   å·¥å…·   â”‚  å·¥å…·   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **RAG** = Agent çš„"çœ¼ç›"ï¼ˆæ„ŸçŸ¥çŸ¥è¯†åº“ï¼‰
- **æ–‡ä»¶å·¥å…·** = Agent çš„"æ‰‹"ï¼ˆæ“ä½œæ–‡ä»¶ï¼‰
- **ç½‘é¡µæœç´¢** = Agent çš„"è€³æœµ"ï¼ˆè·å–å¤–éƒ¨ä¿¡æ¯ï¼‰
- **åˆ†æå·¥å…·** = Agent çš„"æ€ç»´"ï¼ˆå¤„ç†ä¿¡æ¯ï¼‰

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ agent/                      # ğŸ†• Agent æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                 # Agent åŸºç±»ï¼ŒReAct æ¨ç†å¾ªç¯
â”‚   â”œâ”€â”€ rag_agent.py            # RAG Agent å®ç°
â”‚   â””â”€â”€ tools/                  # å·¥å…·é›†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ base.py             # å·¥å…·åŸºç±»
â”‚       â”œâ”€â”€ rag_tools.py        # RAG æ£€ç´¢å·¥å…·
â”‚       â”œâ”€â”€ file_tools.py       # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚       â”œâ”€â”€ web_tools.py        # ç½‘é¡µæœç´¢å·¥å…·
â”‚       â””â”€â”€ analysis_tools.py   # åˆ†æå·¥å…·
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ routes.py               # åŸæœ‰ API
â”‚   â””â”€â”€ agent_routes.py         # ğŸ†• Agent API
â”œâ”€â”€ core/                       # æ ¸å¿ƒä¸šåŠ¡ï¼ˆä¿æŒä¸å˜ï¼‰
â”œâ”€â”€ services/                   # æœåŠ¡å±‚ï¼ˆä¿æŒä¸å˜ï¼‰
â””â”€â”€ ...
```

## ğŸ”§ Agent èƒ½åŠ›

### 1. ReAct æ¨ç†æ¡†æ¶

```
ç”¨æˆ·é—®é¢˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Thought: æˆ‘éœ€è¦åšä»€ä¹ˆï¼Ÿ              â”‚
â”‚     â†“                               â”‚
â”‚  Action: è°ƒç”¨æŸä¸ªå·¥å…·                 â”‚
â”‚     â†“                               â”‚
â”‚  Observation: å·¥å…·è¿”å›ç»“æœ            â”‚
â”‚     â†“                               â”‚
â”‚  Thought: ç»“æœå¤Ÿä¸å¤Ÿï¼Ÿéœ€è¦ç»§ç»­å—ï¼Ÿ     â”‚
â”‚     â†“                               â”‚
â”‚  (å¾ªç¯ç›´åˆ°å¾—å‡ºç­”æ¡ˆ)                   â”‚
â”‚     â†“                               â”‚
â”‚  Final Answer: æœ€ç»ˆç­”æ¡ˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å¯ç”¨å·¥å…·ä¸€è§ˆ

| å·¥å…·åç§° | ç±»åˆ« | æè¿° |
|---------|------|------|
| `rag_search` | æ£€ç´¢ | æœç´¢çŸ¥è¯†åº“ï¼Œæ”¯æŒå‘é‡/BM25/æ··åˆæ£€ç´¢ |
| `list_documents` | æ£€ç´¢ | åˆ—å‡ºçŸ¥è¯†åº“æ‰€æœ‰æ–‡æ¡£ |
| `kb_info` | æ£€ç´¢ | è·å–çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯ |
| `read_file` | æ–‡ä»¶ | è¯»å–æ–‡ä»¶å†…å®¹ |
| `write_file` | æ–‡ä»¶ | å†™å…¥/åˆ›å»ºæ–‡ä»¶ |
| `list_directory` | æ–‡ä»¶ | åˆ—å‡ºç›®å½•å†…å®¹ |
| `move_file` | æ–‡ä»¶ | ç§»åŠ¨/é‡å‘½åæ–‡ä»¶ |
| `create_directory` | æ–‡ä»¶ | åˆ›å»ºç›®å½• |
| `web_search` | ç½‘é¡µ | æœç´¢äº’è”ç½‘ï¼ˆDuckDuckGo/Tavilyï¼‰ |
| `fetch_webpage` | ç½‘é¡µ | è·å–ç½‘é¡µå†…å®¹ |
| `analyze_documents` | åˆ†æ | åˆ†ææ–‡æ¡£ç»“æ„ |
| `summarize` | åˆ†æ | æ€»ç»“æ–‡æœ¬ |
| `generate_report` | åˆ†æ | ç”ŸæˆæŠ¥å‘Š |

### 3. Agent ç±»å‹

| ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `simple` | ä»… RAGï¼Œæ— åæ€ | ç®€å•é—®ç­” |
| `full` | å®Œæ•´åŠŸèƒ½ | é€šç”¨åœºæ™¯ |
| `research` | å¼ºåŒ–ç½‘ç»œæœç´¢ | ç ”ç©¶è°ƒç ” |
| `manager` | å¼ºåŒ–æ–‡ä»¶æ“ä½œ | æ–‡æ¡£ç®¡ç† |

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å‘½ä»¤è¡Œ

```bash
# äº¤äº’å¯¹è¯
python run_agent.py chat

# å•æ¬¡æŸ¥è¯¢
python run_agent.py query "å¸®æˆ‘åˆ†æçŸ¥è¯†åº“ç»“æ„"

# åˆ†æçŸ¥è¯†åº“
python run_agent.py analyze

# ç ”ç©¶ä¸»é¢˜
python run_agent.py research "å¤§è¯­è¨€æ¨¡å‹å‘å±•è¶‹åŠ¿"

# æŸ¥çœ‹å·¥å…·
python run_agent.py tools
```

### Python ä»£ç 

```python
from src.agent.rag_agent import RAGAgent, AgentBuilder

# æ–¹å¼ä¸€ï¼šä½¿ç”¨é¢„è®¾é…ç½®
agent = AgentBuilder.create_full_agent()

# æ–¹å¼äºŒï¼šè‡ªå®šä¹‰é…ç½®
from src.agent.base import AgentConfig

config = AgentConfig(
    max_iterations=10,
    enable_reflection=True,
    enable_planning=True
)
agent = RAGAgent(config=config)

# æ‰§è¡ŒæŸ¥è¯¢
result = agent.run("å¸®æˆ‘åˆ†æçŸ¥è¯†åº“çš„æ–‡æ¡£ç»“æ„")
print(result.answer)

# æ™ºèƒ½æŸ¥è¯¢ï¼ˆè‡ªåŠ¨åˆ¤æ–­ç”¨ RAG è¿˜æ˜¯ Agentï¼‰
result = agent.smart_query("ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Ÿ")
```

### REST API

```bash
# Agent çŠ¶æ€
curl http://localhost:8000/api/agent/status

# åˆ—å‡ºå·¥å…·
curl http://localhost:8000/api/agent/tools

# æ‰§è¡ŒæŸ¥è¯¢
curl -X POST http://localhost:8000/api/agent/query \
  -H "Content-Type: application/json" \
  -d '{"question": "åˆ†æçŸ¥è¯†åº“ç»“æ„å¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®"}'

# æ™ºèƒ½æŸ¥è¯¢
curl -X POST http://localhost:8000/api/agent/smart-query \
  -H "Content-Type: application/json" \
  -d '{"question": "ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Ÿ"}'

# åˆ†æçŸ¥è¯†åº“
curl -X POST http://localhost:8000/api/agent/analyze \
  -H "Content-Type: application/json" \
  -d '{"analysis_type": "all"}'

# ç ”ç©¶ä¸»é¢˜
curl -X POST http://localhost:8000/api/agent/research \
  -H "Content-Type: application/json" \
  -d '{"topic": "RAG æœ€ä½³å®è·µ", "use_web": true}'
```

## ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ™ºèƒ½é—®ç­”

```
ç”¨æˆ·ï¼šä»€ä¹ˆæ˜¯ RAGï¼Ÿ

Agent æ€è€ƒï¼š
  â†’ è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å®šä¹‰é—®é¢˜
  â†’ ä½¿ç”¨ rag_search å·¥å…·æœç´¢çŸ¥è¯†åº“
  â†’ æ‰¾åˆ°ç›¸å…³å†…å®¹ï¼Œç”Ÿæˆç­”æ¡ˆ
```

### åœºæ™¯ 2ï¼šçŸ¥è¯†åº“ç®¡ç†

```
ç”¨æˆ·ï¼šå¸®æˆ‘åˆ†æçŸ¥è¯†åº“çš„ç›®å½•ç»“æ„ï¼Œå¦‚æœä¸åˆç†è¯·æå‡ºå»ºè®®

Agent æ€è€ƒï¼š
  â†’ è¿™æ˜¯ä¸€ä¸ªå¤æ‚ä»»åŠ¡ï¼Œéœ€è¦å¤šä¸ªæ­¥éª¤
  â†’ Step 1: ä½¿ç”¨ list_documents è·å–æ‰€æœ‰æ–‡æ¡£
  â†’ Step 2: ä½¿ç”¨ analyze_documents åˆ†æç»“æ„
  â†’ Step 3: æ ¹æ®åˆ†æç»“æœï¼Œç”Ÿæˆä¼˜åŒ–å»ºè®®
  â†’ Step 4: å¦‚æœç”¨æˆ·åŒæ„ï¼Œä½¿ç”¨ create_directory å’Œ move_file æ‰§è¡Œé‡ç»„
```

### åœºæ™¯ 3ï¼šæ·±åº¦ç ”ç©¶

```
ç”¨æˆ·ï¼šç ”ç©¶ä¸€ä¸‹ 2024 å¹´å¤§è¯­è¨€æ¨¡å‹çš„æœ€æ–°è¿›å±•

Agent æ€è€ƒï¼š
  â†’ è¿™éœ€è¦ç»“åˆæœ¬åœ°çŸ¥è¯†å’Œæœ€æ–°ç½‘ç»œä¿¡æ¯
  â†’ Step 1: ä½¿ç”¨ rag_search æœç´¢æœ¬åœ°çŸ¥è¯†åº“
  â†’ Step 2: ä½¿ç”¨ web_search æœç´¢æœ€æ–°ç½‘ç»œèµ„è®¯
  â†’ Step 3: ä½¿ç”¨ summarize æ€»ç»“å…³é”®ä¿¡æ¯
  â†’ Step 4: ä½¿ç”¨ generate_report ç”Ÿæˆç ”ç©¶æŠ¥å‘Š
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### æ–‡ä»¶æ“ä½œé™åˆ¶

- åªå…è®¸æ“ä½œæŒ‡å®šç›®å½•ï¼ˆ`./documents`, `./uploads`, `./output`ï¼‰
- åˆ é™¤æ“ä½œéœ€è¦æ˜¾å¼ç¡®è®¤
- æ“ä½œæ—¥å¿—è®°å½•

### å·¥å…·æƒé™æ§åˆ¶

```python
# åˆ›å»ºåªè¯» Agentï¼ˆæ— æ–‡ä»¶å†™å…¥èƒ½åŠ›ï¼‰
agent = RAGAgent(
    enable_file_ops=False,
    enable_web_search=True
)
```

## ğŸ“Š æ€§èƒ½è€ƒè™‘

- **è¿­ä»£æ¬¡æ•°é™åˆ¶**ï¼šé»˜è®¤æœ€å¤š 10 æ¬¡è¿­ä»£ï¼Œé˜²æ­¢æ— é™å¾ªç¯
- **è¶…æ—¶æ§åˆ¶**ï¼šå•æ¬¡å·¥å…·è°ƒç”¨æœ‰è¶…æ—¶é™åˆ¶
- **ç»“æœç¼“å­˜**ï¼šç›¸åŒæŸ¥è¯¢å¯å¯ç”¨ç¼“å­˜

## ğŸ”® åç»­æ‰©å±•

1. **å¤š Agent åä½œ**ï¼šæ”¯æŒå¤šä¸ª Agent ååŒå·¥ä½œ
2. **é•¿æœŸè®°å¿†**ï¼šæŒä¹…åŒ–å¯¹è¯å†å²å’Œå­¦ä¹ ç»“æœ
3. **è‡ªå®šä¹‰å·¥å…·**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å·¥å…·
4. **å·¥ä½œæµç¼–æ’**ï¼šæ”¯æŒå¤æ‚å·¥ä½œæµå®šä¹‰

---

## ğŸ“ ä½œå“é›†æè¿°å»ºè®®

> "æˆ‘å¼€å‘äº†ä¸€ä¸ª**å…¨è‡ªåŠ¨çŸ¥è¯†èµ„äº§ç®¡ç† Agent**ï¼Œå…¶åº•å±‚æ¶æ„åŸºäº RAG æ£€ç´¢é“¾è·¯ï¼Œå¹¶å¼•å…¥äº† ReActï¼ˆæ¨ç†-è¡ŒåŠ¨ï¼‰æ¡†æ¶ã€‚è¯¥ç³»ç»Ÿå…·å¤‡ï¼š
> 
> - **è‡ªä¸»å†³ç­–èƒ½åŠ›**ï¼šæ ¹æ®é—®é¢˜å¤æ‚åº¦è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¤„ç†ç­–ç•¥
> - **å¤šå·¥å…·åè°ƒ**ï¼šæ•´åˆçŸ¥è¯†åº“æ£€ç´¢ã€ç½‘é¡µæœç´¢ã€æ–‡ä»¶ç®¡ç†ç­‰ 12+ ç§å·¥å…·
> - **è‡ªçœä¸åæ€**ï¼šæ‰§è¡Œåè‡ªåŠ¨è¯„ä¼°ç»“æœè´¨é‡ï¼Œå¿…è¦æ—¶é‡æ–°è§„åˆ’
> - **è§„åˆ’ä¸æ‹†è§£**ï¼šå°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„å­ä»»åŠ¡
> 
> æŠ€æœ¯æ ˆï¼šPython, FastAPI, LangChain, ChromaDB, Ollama/OpenAI"
